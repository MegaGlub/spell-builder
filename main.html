<!DOCTYPE html>
<head>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <div class = "mainMenuScreen" id = "mainMenuScreen">
    <span class = "mainMenuButtons">
      <button class = "mainMenuSpellsButton" onclick = "mainMenuSpellsButtonPress()" id = "mainMenuSpellsButton">
        Spell Workbench</button>
      <button class = "mainMenuMartialsButton" onclick = "mainMenuMartialsButtonPress()" id = "mainMenuMartialsButton">
        Martial Arts</button>
    </span>
  </div>

  <span class = "spellBox">
  </span>

  <span class = "wandBox">
    <span class = "wandSelector">
    </span>
  </span>
  
  <div class = "bottomToolBar">
    <button class = "bottomToolBarButton" onclick = "unhideMainMenu()">
      Main Menu
    </button>
  </div>
</body>
<script>
  const mainMenuSpellsButton = document.getElementById("mainMenuSpellsButton");
  const mainMenuMartialsButton = document.getElementById("mainMenuMartialsButton");
  const mainMenuScreen = document.getElementById("mainMenuScreen");
  const toolTipButtons = document.getElementsByClassName("toolTipButton");
  const spellBox = document.getElementsByClassName("spellBox")[0];
  var componentList = [];

  class spellComponent {
    constructor(name, type, description, image, primaryCost, primaryType, secondaryCost, secondaryType, energyCost, potencyModifier){
      this.name = name;
      this.type = type;
      this.description = description;
      this.image = image;
      this.primaryCost = primaryCost;
      this.primaryType = primaryType;
      this.secondaryCost = secondaryCost;
      this.secondaryType = secondaryType;
      this.energyCost = energyCost;
      this.potencyModifier = potencyModifier;

      this.buildComponentVisuals();
      componentList.push(this);
    }

    buildComponentVisuals(){
      const newToolTipButton = document.createElement("div");
      const newToolTip = document.createElement("div");
      const newSpellTitle = document.createElement("div");
      const newSpellType = document.createElement("div");
      const newSpellDescription = document.createElement("div");
      const newComponent = document.createElement("span");
      const newImage = document.createElement("img");
      const newStatTable = document.createElement("table");
      const visRow = document.createElement("tr");
      const newPrimaryCell = document.createElement("td");
      const newSecondaryCell = document.createElement("td");
      const newEnergyCell = document.createElement("td");
      const modifierRow = document.createElement("tr");
      const newPotencyCell = document.createElement("td");

      newToolTipButton.id = "spellComponent" + this.name;

      newToolTipButton.className = "toolTipButton";
      newComponent.className = "spellComponent";
      newToolTip.className = "toolTip";
      newSpellTitle.className = "spellTitle";
      newSpellType.className = "spellType";
      newSpellDescription.className = "spellDescription";
      newStatTable.className = "componentStatTable";
      visRow.className = "componentStatRow";
      modifierRow.className = "componentStatRow";
      newPrimaryCell.className = "componentStatCell";
      newSecondaryCell.className = "componentStatCell";
      newEnergyCell.className = "componentStatCell";
      newPotencyCell.className = "componentStatCell";

      spellBox.appendChild(newToolTipButton);
      newToolTipButton.appendChild(newComponent);
      newToolTipButton.appendChild(newToolTip);
      newToolTip.appendChild(newSpellTitle);
      newToolTip.appendChild(newSpellType);
      newToolTip.appendChild(newSpellDescription);
      newToolTip.appendChild(newStatTable);
      newStatTable.appendChild(visRow);
      visRow.appendChild(newPrimaryCell);
      visRow.appendChild(newSecondaryCell);
      visRow.appendChild(newEnergyCell);
      newStatTable.appendChild(modifierRow);
      modifierRow.appendChild(newPotencyCell);
      newComponent.appendChild(newImage);

      newImage.src = this.image;

      newSpellTitle.innerHTML = this.name;
      newSpellType.innerHTML = this.type;
      newSpellType.style.color = this.getTypeColor();
      newSpellDescription.innerHTML = this.description;

      newPrimaryCell.innerHTML = this.formattedDataCell(this.primaryCost, this.primaryType);
      newSecondaryCell.innerHTML = this.formattedDataCell(this.secondaryCost, this.secondaryType);
      newEnergyCell.innerHTML = this.formattedDataCell(this.energyCost, "Energy");

      newPotencyCell.innerHTML = this.formattedDataCell(this.potencyModifier, "Potency");
    }

    formattedDataCell(num, descriptor){
      if (this.type == "Void" && descriptor == "Potency"){
        return "Inverted Potency";
      }else{
        return this.#getSignedCost(num) + " " + descriptor;
      }
    }

    #getSignedCost(num){
      if (num < 0){
        return "-" + num;
      } else{
        return "+" + num;
      }
    }

    getTypeColor(){
      switch(this.type){
        case "Void":
          return "#8A2BE2";
          break;
        case "Form":
          return "#A0AECD";
          break;
        default:
          return "#FFFFF0";
          break;
      }
    }
  }
  class formComponent extends spellComponent{
    constructor(name, description, formDescription, image, primaryCost, secondaryCost, energyCost, potencyModifier, size){
      super(name, "Form", description, image, primaryCost, "Primary", secondaryCost, "Secondary", energyCost, potencyModifier);
      this.formDescription = formDescription;
      this.size = size;
      this.buildFormVisuals();
    }

    buildFormVisuals(){
      const spellComponent = document.getElementById("spellComponent" + this.name);
      const statTable = spellComponent.lastChild.lastChild;
      const tableRows = statTable.getElementsByClassName("componentStatRow");
      const newSizeCell = document.createElement("td");

      tableRows[1].appendChild(newSizeCell);

      newSizeCell.className = "componentStatCell";

      newSizeCell.innerHTML = "Size: " + this.size;
    }
  }

  const testComponent = new spellComponent(
    "Nothing",
    "Void",
    "Lack of anything at all.",
    "images/nothing.png",
    0,
    "Primary",
    0,
    "Secondary",
    0,
    0
  );

  const testComponent2 = new formComponent(
    "Ball",
    "In the shape of a fist sized ball.",
    "a fist sized ball of ",
    "images/forms/ball.png",
    0,
    0,
    0,
    0,
    "5cm"
  );

  function mainMenuSpellsButtonPress(){
    hideMainMenu();
  }

  function mainMenuMartialsButtonPress(){
    hideMainMenu();
  }

  function hideMainMenu(){
    mainMenuSpellsButton.disabled = true;
    mainMenuMartialsButton.disabled = true;
    mainMenuScreen.style.display = "none";
  }

  function unhideMainMenu(){
    mainMenuScreen.style.display = "flex";
    mainMenuSpellsButton.disabled = false;
    mainMenuMartialsButton.disabled = false;
  }
  
  console.log(toolTipButtons);
  for (index = 0; index < toolTipButtons.length; index++){
    assignToolTips(toolTipButtons[index]);
  }

  function assignToolTips(toolTipButton){
    toolTipButton.addEventListener('mousemove', function(event){
      updateToolTipPosition(event, toolTipButton)}
      );
  }
  
  function updateToolTipPosition(mouseEvent, toolTipButton){
    const toolTip = toolTipButton.getElementsByClassName("toolTip")[0];
    const clientX = mouseEvent.clientX;
    const clientY = mouseEvent.clientY;
    const windowWidth = window.innerWidth;
    const windowHeight = window.innerHeight;
    const toolTipWidth = toolTip.offsetWidth;
    const toolTipHeight = toolTip.offsetHeight;

    if (clientX + toolTipWidth + 18 > windowWidth){
      toolTip.style.left = (windowWidth - toolTipWidth) + "px";
    }else{
      toolTip.style.left = clientX + 18 + "px";
    }

    if (clientY + toolTipHeight + 12 > windowHeight){
      toolTip.style.top = (windowHeight - toolTipHeight) + "px";
    }else{
      toolTip.style.top = clientY + 12 + "px";
    }
  }
</script>